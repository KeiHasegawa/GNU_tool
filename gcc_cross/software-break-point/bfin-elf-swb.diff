*** gdb-10.2.org/gdb/infrun.c	2021-04-25 13:06:26.000000000 +0900
--- gdb-10.2.bfin-elf/gdb/infrun.c	2021-12-25 13:59:35.000000000 +0900
***************
*** 5782,5787 ****
--- 5782,5795 ----
  
  /* Come here when the program has stopped with a signal.  */
  
+ #undef target_stopped_by_sw_breakpoint
+ bool target_stopped_by_sw_breakpoint(CORE_ADDR pc)
+ {
+   regcache* regcache = get_current_regcache();
+   const address_space* aspace = regcache->aspace();
+   return breakpoint_here_p(aspace, pc) == no_breakpoint_here;
+ }
+ 
  static void
  handle_signal_stop (struct execution_control_state *ecs)
  {
***************
*** 6116,6125 ****
  
    /* Maybe this was a trap for a software breakpoint that has since
       been removed.  */
!   if (random_signal && target_stopped_by_sw_breakpoint ())
      {
        if (gdbarch_program_breakpoint_here_p (gdbarch,
! 					     ecs->event_thread->suspend.stop_pc))
  	{
  	  struct regcache *regcache;
  	  int decr_pc;
--- 6124,6133 ----
  
    /* Maybe this was a trap for a software breakpoint that has since
       been removed.  */
!   if (random_signal && target_stopped_by_sw_breakpoint (ecs->event_thread->suspend.stop_pc-2))
      {
        if (gdbarch_program_breakpoint_here_p (gdbarch,
! 					     ecs->event_thread->suspend.stop_pc)-2)
  	{
  	  struct regcache *regcache;
  	  int decr_pc;
***************
*** 6127,6133 ****
  	  /* Re-adjust PC to what the program would see if GDB was not
  	     debugging it.  */
  	  regcache = get_thread_regcache (ecs->event_thread);
! 	  decr_pc = gdbarch_decr_pc_after_break (gdbarch);
  	  if (decr_pc != 0)
  	    {
  	      gdb::optional<scoped_restore_tmpl<int>>
--- 6135,6141 ----
  	  /* Re-adjust PC to what the program would see if GDB was not
  	     debugging it.  */
  	  regcache = get_thread_regcache (ecs->event_thread);
! 	  decr_pc = 2;
  	  if (decr_pc != 0)
  	    {
  	      gdb::optional<scoped_restore_tmpl<int>>
***************
*** 6138,6144 ****
  		  (record_full_gdb_operation_disable_set ());
  
  	      regcache_write_pc (regcache,
! 				 ecs->event_thread->suspend.stop_pc + decr_pc);
  	    }
  	}
        else
--- 6146,6152 ----
  		  (record_full_gdb_operation_disable_set ());
  
  	      regcache_write_pc (regcache,
! 				 ecs->event_thread->suspend.stop_pc);
  	    }
  	}
        else
