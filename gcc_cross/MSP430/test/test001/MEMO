newlib を -O0 でビルドし直したらコンパイラの内部エラーが発生した.
特に string のソースをコンパイルしているとき.

----------------------------------------------------------------------------

実行すると数回 _sbrk_r が呼び出された後 msp430-elf-gdb が exit(0) の呼び出し
をして終了する. 調べてみると msp430 のシミュレータで

      if (u1)
	{
	  TRACE_BRANCH (MSP430_CPU (sd), "J%s: pc %#x -> %#x sr %#x, taken",
			cond_string (opcode->cond), PC, i, SR);
	  PC = i;
	  if (PC == opcode_pc)
	    exit (0);

のようなコードになっている. このときは 0x2340 番地でこのコード自体は

00002340  w    F .text	00000004 exit

ということらしい. これ自体は問題なし.



2022.02.13 11:20
リンカの最適化をはずしてみたところ br 命令がそのまま出ているため上の exit は呼び出され
なくなったが, 通常通り quit コマンドで終了させるようにした.


