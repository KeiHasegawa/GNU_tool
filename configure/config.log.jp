libX11-1.6.12 で ./configure を実行したときのメモ

% ./configure
...
checking for nl_langinfo... yes
checking for X11... no
configure: error: Package requirements (xproto >= 7.0.17 xextproto xtrans xcb >= 1.11.1 kbproto inputproto) were not met:

Package 'xtrans', required by 'virtual:world', not found

Consider adjusting the PKG_CONFIG_PATH environment variable if you
installed software in a non-standard prefix.

Alternatively, you may set the environment variables X11_CFLAGS
and X11_LIBS to avoid the need to call pkg-config.
See the pkg-config man page for more details.
%

となる. ./configure コマンドがエラーしたということなのだが, これだけ見ると

xtrans

というパッケージがないということなのだと推測される.

ところで ./configure の中を調べると以下を見つける:

cat >config.log <<_ACEOF
This file contains any messages produced by compilers while
running configure, to aid debugging if configure makes a mistake.

It was created by libX11 $as_me 1.6.12, which was
generated by GNU Autoconf 2.69.  Invocation command line was

  $ $0 $@

_ACEOF

これは, config.log に何かを書き込んでいる. config.log の先頭は以下:

This file contains any messages produced by compilers while
running configure, to aid debugging if configure makes a mistake.

It was created by libX11 configure 1.6.12, which was
generated by GNU Autoconf 2.69.  Invocation command line was

  $ ./configure 

なるほどというところである. さて問題のエラーを config.log から探してみると
以下を見つけた:

configure:21474: checking for X11
configure:21481: $PKG_CONFIG --exists --print-errors "$X11_REQUIRES"
Package xtrans was not found in the pkg-config search path.
Perhaps you should add the directory containing `xtrans.pc'
to the PKG_CONFIG_PATH environment variable
Package 'xtrans', required by 'virtual:world', not found
configure:21484: $? = 1
configure:21498: $PKG_CONFIG --exists --print-errors "$X11_REQUIRES"
Package xtrans was not found in the pkg-config search path.
Perhaps you should add the directory containing `xtrans.pc'
to the PKG_CONFIG_PATH environment variable
Package 'xtrans', required by 'virtual:world', not found
configure:21501: $? = 1
configure:21515: result: no
Package 'xtrans', required by 'virtual:world', not found
configure:21531: error: Package requirements (xproto >= 7.0.17 xextproto xtrans xcb >= 1.11.1 kbproto inputproto) were not met:

Package 'xtrans', required by 'virtual:world', not found

Consider adjusting the PKG_CONFIG_PATH environment variable if you
installed software in a non-standard prefix.

Alternatively, you may set the environment variables X11_CFLAGS
and X11_LIBS to avoid the need to call pkg-config.
See the pkg-config man page for more details.

ということである. またさらにその後の部分に以下を見つけることができた:

PKG_CONFIG='/usr/bin/pkg-config'

残念ながら X11_REQUIRES については何も見つけることができなかった.
これから推察できることは:

/usr/bin/pkg-config --exists --print-errors "$X11_REQUIRES"

を実行したがエラーし, しかし現状変数 X11_REQUIRES については分からない
ということである. 今度は config.log ではなくて該当する ./configure の行
を調べてみる.

    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"\$X11_REQUIRES\""; } >&5

である. やはり変数 X11_REQUIRES が使われているということだけは分かる.
./configure から X11_REQUIRES を検索すると

X11_REQUIRES='xproto >= 7.0.17 xextproto xtrans xcb >= 1.11.1'
...
   X11_REQUIRES="${X11_REQUIRES} kbproto inputproto"

が該当する. ということは, おそらく

/usr/bin/pkg-config --exists --print-errors 'xproto >= 7.0.17 xextproto xtrans xcb >= 1.11.1 kbproto inputproto'

を実行した結果エラーしたということなのだろう. 実際に実行してみた:

% /usr/bin/pkg-config --exists --print-errors 'xproto >= 7.0.17 xextproto xtrans xcb >= 1.11.1 kbproto inputproto'
Package xtrans was not found in the pkg-config search path.
Perhaps you should add the directory containing `xtrans.pc'
to the PKG_CONFIG_PATH environment variable
Package 'xtrans', required by 'virtual:world', not found
%

どうやら正解らしい.
実はこの ./configure の実行に先立って xtrans をインストールしていたつもりで
はあった. 実際

/usr/local/share/pkgconfig/xtrans.pc

はある. なのであとは /usr/bin/pkg-config の実行時にこれを見つけてあげられる
ようにすればよい. 改めて最初のエラーメッセージに戻ると

PKG_CONFIG_PATH

の値が問題で /usr/local/share/pkgconfig/xtrans.pc を探せていなかったのだと
気付く.

% printenv PKG_CONFIG_PATH

何もセットされていないらしい.

% setenv PKG_CONFIG_PATH /usr/local/share/pkgconfig:/usr/share/pkgconfig
% /usr/bin/pkg-config --exists --print-errors 'xproto >= 7.0.17 xextproto xtrans xcb >= 1.11.1 kbproto inputproto'
%

今度は大丈夫らしい.
