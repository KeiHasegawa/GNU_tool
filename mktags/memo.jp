タグ生成

(*1) vi での ctags の簡単な使い方
(*2) emacs での ctags の簡単な使い方
(*3) プログラムファイルからタグファイルを生成する

(*1) vi での ctags の簡単な使い方

起動時にタグジャンプ	vi -t <タグ名>
タグジャンプ		:ta <タグ名>
タグジャンプ		Ctrl-]
元に戻る			Ctrl-T

% cat a.c
#include <stdio.h>

void f();

#define X 2

int main()
{
  printf("hello\n");
  f();
  return 0;
}
% cat b.c
#include "d.h"

int a;

void g(int);

void f()
{
  g(a);
  g(X);
}

int f2(location loc)
{
  return loc;
}
% cat c.c
#include <stdio.h>
#include "d.h"

void g(int n)
{
  printf("n = %d\n", n);
}

extern int a;

void h(struct S* ps)
{
  printf("ps->m = %d\n", ps->m);
  printf("a = %d\n", a);
}
% cat d.h
#ifndef D_H
#define D_H

#define X 1

struct S {
  int m;
};

typedef unsigned int location;

#endif /* D_H */
% ctags a.c b.c c.c d.h
# tags というファイルが生成される
% vi -t location
# vi が起動して d.h の location の定義位置が表示される
vi のコマンドで
:ta main
のようにするとタグ main ジャンプできる.
探したい名前のところにカーソルをもっていって

Ctrl-] 

とすればタグジャンプできる. タグジャンプした後

Ctrl-T

とすればもとに戻ることができる.

(*2) emacs での ctags の簡単な使い方

タグファイルを読み込む	M-x visit-tags-table
タグジャンプ		M-.
元に戻る			M-*
次の候補			C-u M-.

% ctags -e b.c c.c hoge.c d.h
# TAGS というファイルが作成される

emacs を起動して

M-x visit-tags-table

で生成した TAGS を指定する. 通常はカレントディレクトリの TAGS ファイルを
開こうとしているから, その場合はリターンキーを押せばよい.

ファイルを開いた状態で探したい名前のところにカーソルをもっていって

M-.

とすればタグジャンプできる. タグジャンプした後

M-*

とすればもとに戻ることができる.

C-u M-.

とすれば複数候補の次にジャンプする. a.c と d.h にマウロ X の
定義がそれぞれあるので X にタグジャンプすると
a.c の X の定義にジャンプする. その後

C-u M-.

とすると d.h の X の定義にジャンプする.

(*3) プログラムファイルからタグファイルを生成する

     mktags.exe のビルド

 linux % g++ -o mktags.exe mktags.cpp -g3 -DPACKAGE -lbfd -liberty -L/home/khasegawa/binutils-2.36.1-2.src/binutils-2.36.1/libiberty -ldl -lz

cygwin % g++ -o mktags.exe mktags.cpp -g3 -DPACKAGE -lbfd -liberty -ldl -lz -lintl

     linux ならば binutils のソースからビルドする必要がある(かもしれない).

% ./mktags.exe a.out
# tags が生成される. vi 用
% ./mktags -e a.out
# TAGS が生成される. emacs 用.

     2021/05/13 11:09 ひとまず linux 版でそれなりに動作するようにしたが, マクロ
     の定義と構造体, typedef は未対応. vi でタグジャンプしようとすると

     Press ENTER or type command to continue

     のようにいちいち聞いてくる.

     cygwin 版は変数 a に対してタグが生成されていない. また cygwin 版の vi では
     mktags.exe が生成した tags でタグジャンプできていない.

% cat tags
main	/cygdrive/d/home/khasegawa/ctags_test/a.c	/^int main()$/;"	f
f	/cygdrive/d/home/khasegawa/ctags_test/b.c	/^void f()$/;"	f
f2	/cygdrive/d/home/khasegawa/ctags_test/b.c	/^int f2(location loc)$/;"	f
g	/cygdrive/d/home/khasegawa/ctags_test/c.c	/^void g(int n)$/;"	f
h	/cygdrive/d/home/khasegawa/ctags_test/c.c	/^void h(struct S* ps)$/;"	f
WinMainCRTStartup	/cygdrive/d/home/khasegawa/my_cygwin/cygwin-3.1.6-1.src/newlib-cygwin/x86_64-pc-cygwin/winsup/cygwin/../../.././winsup/cygwin/crt0.c	/^mainCRTStartup ()$/;"	f
mainCRTStartup	/cygdrive/d/home/khasegawa/my_cygwin/cygwin-3.1.6-1.src/newlib-cygwin/x86_64-pc-cygwin/winsup/cygwin/../../.././winsup/cygwin/crt0.c	/^$/;"	f
_fmode	/cygdrive/d/home/khasegawa/my_cygwin/cygwin-3.1.6-1.src/newlib-cygwin/x86_64-pc-cygwin/winsup/cygwin/../../.././winsup/cygwin/lib/_cygwin_crt0_common.cc	/^#endif$/;"	
__cygwin_cxx_malloc	/cygdrive/d/home/khasegawa/my_cygwin/cygwin-3.1.6-1.src/newlib-cygwin/x86_64-pc-cygwin/winsup/cygwin/../../.././winsup/cygwin/lib/_cygwin_crt0_common.cc	/^$/;"	
_cygwin_crt0_common	/cygdrive/d/home/khasegawa/my_cygwin/cygwin-3.1.6-1.src/newlib-cygwin/x86_64-pc-cygwin/winsup/cygwin/../../.././winsup/cygwin/lib/_cygwin_crt0_common.cc	/^_cygwin_crt0_common (MainFunc f, per_process *u)$/;"	f
atexit	/cygdrive/d/home/khasegawa/my_cygwin/cygwin-3.1.6-1.src/newlib-cygwin/x86_64-pc-cygwin/winsup/cygwin/../../.././winsup/cygwin/lib/atexit.c	/^atexit (void (*fn) (void))$/;"	f
cygwin_attach_dll	/cygdrive/d/home/khasegawa/my_cygwin/cygwin-3.1.6-1.src/newlib-cygwin/x86_64-pc-cygwin/winsup/cygwin/../../.././winsup/cygwin/lib/cygwin_attach_dll.c	/^cygwin_attach_dll (HMODULE h, MainFunc f)$/;"	f
cygwin_crt0	/cygdrive/d/home/khasegawa/my_cygwin/cygwin-3.1.6-1.src/newlib-cygwin/x86_64-pc-cygwin/winsup/cygwin/../../.././winsup/cygwin/lib/cygwin_crt0.c	/^cygwin_crt0 (MainFunc f)$/;"	f
_cygwin_dll_entry	/cygdrive/d/home/khasegawa/my_cygwin/cygwin-3.1.6-1.src/newlib-cygwin/x86_64-pc-cygwin/winsup/cygwin/../../.././winsup/cygwin/lib/dll_entry.c	/^$/;"	f
__dynamically_loaded	/cygdrive/d/home/khasegawa/my_cygwin/cygwin-3.1.6-1.src/newlib-cygwin/x86_64-pc-cygwin/winsup/cygwin/../../.././winsup/cygwin/lib/dll_entry.c	/^$/;"	
_cygwin_noncygwin_dll_entry	/cygdrive/d/home/khasegawa/my_cygwin/cygwin-3.1.6-1.src/newlib-cygwin/x86_64-pc-cygwin/winsup/cygwin/../../.././winsup/cygwin/lib/dll_entry.c	/^$/;"	f
dll_index	/cygdrive/d/home/khasegawa/my_cygwin/cygwin-3.1.6-1.src/newlib-cygwin/x86_64-pc-cygwin/winsup/cygwin/../../.././winsup/cygwin/lib/dll_entry.c	/^$/;"	
storedHandle	/cygdrive/d/home/khasegawa/my_cygwin/cygwin-3.1.6-1.src/newlib-cygwin/x86_64-pc-cygwin/winsup/cygwin/../../.././winsup/cygwin/lib/dll_entry.c	/^$/;"	
storedReason	/cygdrive/d/home/khasegawa/my_cygwin/cygwin-3.1.6-1.src/newlib-cygwin/x86_64-pc-cygwin/winsup/cygwin/../../.././winsup/cygwin/lib/dll_entry.c	/^$/;"	
storedPtr	/cygdrive/d/home/khasegawa/my_cygwin/cygwin-3.1.6-1.src/newlib-cygwin/x86_64-pc-cygwin/winsup/cygwin/../../.././winsup/cygwin/lib/dll_entry.c	/^$/;"	
__dllMain	/cygdrive/d/home/khasegawa/my_cygwin/cygwin-3.1.6-1.src/newlib-cygwin/x86_64-pc-cygwin/winsup/cygwin/../../.././winsup/cygwin/lib/dll_entry.c	/^$/;"	
DllMain	/cygdrive/d/home/khasegawa/my_cygwin/cygwin-3.1.6-1.src/newlib-cygwin/x86_64-pc-cygwin/winsup/cygwin/../../.././winsup/cygwin/lib/dll_main.cc	/^  return TRUE;$/;"	f
cygwin_premain0	/cygdrive/d/home/khasegawa/my_cygwin/cygwin-3.1.6-1.src/newlib-cygwin/x86_64-pc-cygwin/winsup/cygwin/../../.././winsup/cygwin/lib/premain0.c	/^{$/;"	f
cygwin_premain1	/cygdrive/d/home/khasegawa/my_cygwin/cygwin-3.1.6-1.src/newlib-cygwin/x86_64-pc-cygwin/winsup/cygwin/../../.././winsup/cygwin/lib/premain1.c	/^{$/;"	f
cygwin_premain2	/cygdrive/d/home/khasegawa/my_cygwin/cygwin-3.1.6-1.src/newlib-cygwin/x86_64-pc-cygwin/winsup/cygwin/../../.././winsup/cygwin/lib/premain2.c	/^{$/;"	f
cygwin_premain3	/cygdrive/d/home/khasegawa/my_cygwin/cygwin-3.1.6-1.src/newlib-cygwin/x86_64-pc-cygwin/winsup/cygwin/../../.././winsup/cygwin/lib/premain3.c	/^{$/;"	f
_pei386_runtime_relocator	/cygdrive/d/home/khasegawa/my_cygwin/cygwin-3.1.6-1.src/newlib-cygwin/x86_64-pc-cygwin/winsup/cygwin/../../.././winsup/cygwin/lib/pseudo-reloc-dummy.c	/^  return;$/;"	f
% vi -t main
E432: Tags file not sorted
E426: tag not found: main
Press ENTER or type command to continue
...
% cat tags  # 最初の 1 行だけにしてみた.
% vi -t main
これなら一応大丈夫
